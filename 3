AWSのサービスVPCについてまとめました

今回はAWSを扱う上で必須となるサービスVPCについて説明していきます。

下の図が示す様にAWSサービスを収納するための、入れ物のイメージを持っていただけたらと思います。

画像に alt 属性が指定されていません。ファイル名: Untitled-Diagram-4.png
続きを読む
🔗リージョン
AWSはクラウドサービスを提供するために、世界各地にデータセンターを保有しています。
私達はAWSサービスを利用する時に、このデータセンターの一部を使っている事になります。

これらのデータセンターは、リージョンという単位で地理的に分割して管理されています。

リージョンとリージョンの間は完全に分離されており、あるリージョンで障害が発生しても、他のリージョンに影響が及ぶことはありません。

リージョンはその地域の法律に準拠しているので、データ保護法等について考える必要も少なくなります。

<p>データ保護法等については<a href="https://www.iso27001.jp/blog/cloud/5256/" target="_blank" rel="noopener noreferrer">この記事</a>を参考にさせて頂きました。</p>
🔗VPC
AWSサービスを起動するためのユーザー専用のプライベートな仮想ネットワークで、リージョン内に作成します。

AWSサービスをVPCという入れ物に入れることで、インターネットに公開したりすることができます。

なので下図の様にアプリや、OSが起動する上で一番基盤になる部分になります。

画像に alt 属性が指定されていません。ファイル名: 2.png
VPCの各種設定
🔗デフォルトのVPC
デフォルトのVPCには最低限必要な設定がされています。

各リージョンに一つだけ作成することができ、クリックするだけで何度でも作成できます。

🔗IPv4 CIDR ブロック
許可されるブロックサイズは、/16 サブネットマスク（65,536 個の IP アドレス）から /28 サブネットマスク（16 個の IP アドレス）の間です。

VPCを一度作成すると変更することはできないです。

<p>サブネットマスクについては<a href="https://qiita.com/mogulla3/items/efb4c9328d82d24d98e6#4-%E3%82%B5%E3%83%96%E3%83%8D%E3%83%83%E3%83%88%E3%83%9E%E3%82%B9%E3%82%AF" target="_blank" rel="noopener noreferrer">この記事</a>を参考にさせて頂きました。</p>
🔗IPv６ CIDR ブロック
IPアドレスの数が不足してきているので、IPv4 CIDR ブロックよりもたくさん定義できる様にしたのがIPv6 CIDR ブロックです。

<p>IPアドレスの不足は<a href="https://mypage.otsuka-shokai.co.jp/contents/business-oyakudachi/pc-techo/2013/201312.html" target="_blank" rel="noopener noreferrer">この記事</a>を参考にさせて頂きました。</p>
🔗テナンシー
顧客が運用するアプリがコンプライアンス上、他社のEC2と同一サーバを同居できない場合などに、ハードウェアを専有するために利用される。

「デフォルト」では他のアカウントと同居します。

テナンシーを選択することでDedicated InstanceとDedicated Host(s)を使うことができます。

<p>テナントについては<a href="https://dev.classmethod.jp/articles/ec2-tenancy/" target="_blank" rel="noopener noreferrer">この記事</a>を参考にさせて頂きました。</p>
🔗フローログ
VPC フローログは、VPC の中にあるサービス間で,どの様に情報が行き来しているかを把握するための機能です。

フローログはデータを CloudWatch Logs または Amazon S3 に渡すことができます。

デフォルトでは、IAM ユーザーにはフローログを利用するためのアクセス許可がないので、利用したい場合はIAMポリシーをIAMユーザーにアタッチする必要があります。

🔗DHCP オプションセットの編集
IPv4で通信を行う時、個々のホストにIPv4アドレス、 サブネットマスク、DNSサーバのアドレス等設定することがたくさんあります。

DHCPを利用すると、これらの設定を自動でしてくれます。

🔗DNS
インターネットで利用される名前を、対応する IP アドレスに変換するためのサービスです。

画像に alt 属性が指定されていません。ファイル名: ４.png
🔗DNS 解決の編集、DNS ホスト名の編集
プライベートホストゾーンとは、VPC内だけで利用するドメインを定義する方法です。

<p>プライベートホストゾーンは<a href="https://qiita.com/kter/items/d92d6e361a718a23c0bd" target="_blank" rel="noopener noreferrer">この記事</a>を参考にさせて頂きました。</p>
このプライベートホストゾーンを利用するためには、DNS 解決、DNS ホスト名の編集の設定が必要になります。

DNS ホスト名の編集はデフォルトでは無効になっているので、気をつけてください。

🔗タグ
キーにName,Role,Purpose,Stage,Team等、AWSサービスを区別するために使われます。

私はAWSサービスを作成する時に、キーにName、値にAWSサービスに付けたい名前の設定くらいしかしていなかったです。

これをするとAWSサービスに名前をつけてくれます。

料金表
画像に alt 属性が指定されていません。ファイル名: 3.png
まとめ
IPv6 CIDR ブロック、テナンシー、DNSは今回記事を書くまで、触った事のないサービスでした。

VPCのサービスは料金が発生しないものが多いので、あまり深く勉強しようと思ったことはなかったです。

しかし、説明した通りAWSのサービスの中で一番基盤になるサービスです。

ネットワーク構成が複雑だったり、長期的に運用するのであれば、基盤をしっかり考える必要があると思います。

