ALBの機能スティッキーセッションを使ってみた

今回ALBの機能スティッキーセッションについてまとめました。

また、効率良くEC2を作成する様に工夫してみました。

画像に alt 属性が指定されていません。ファイル名: Untitled-Diagram-11.png
続きを読む
🔗スティッキーセッションとは
例えばECサイト等ユーザーがセッション情報を保持する様なインスタンスに適しています。

もし、この設定をしなかったらユーザーは一度個人情報を入力しても、画面遷移した際に別のインスタンスに負荷分散されてしまい、再度個人情報を入力し直さないといけなくなります。

🔗EC2
🔗EC2の作成
以前の記事を参考に以下ユーザーデータを利用してインスタンスを作成してください。

#!/bin/bash
yum update -y
sudo yum -y install httpd
sudo service httpd start
echo "$(hostname -f)" > /var/www/html/index.html

- Lang Select -
data-line属性値
ファイル名
この段階でパブリックIPをブラウザに入力すると以下の様な画面が出てきて、プライベートIPアドレスを確認できます。

画像に alt 属性が指定されていません。ファイル名: スクリーンショット-2020-10-30-16.14.17-1024x318.png
同じ設定のインスタンスを別アベイラビリティーゾーンに作成します。

1、2、3の順でクリックします。

画像に alt 属性が指定されていません。ファイル名: スクリーンショット-2020-10-30-16.18.02-1024x311.png
「インスタンスの設定」で先ほど作成したインスタンスと別AZを選択します。

画像に alt 属性が指定されていません。ファイル名: スクリーンショット-2020-10-30-16.21.32-1024x561.png
「タグの追加」で「値」を変更します。

画像に alt 属性が指定されていません。ファイル名: スクリーンショット-2020-10-30-16.24.58-1024x298.png
🔗ALB
🔗ALBの作成
以前の記事を参考にALBを作成してください。

ただし、ヘルスチェックのパス指定に関しては、health.htmlを作成するのが面倒なのであればindex.htmlにしても良いです。

＊本番環境ではhealth.htmlとindex.htmlを分けて作成し、ヘルスチェックのパス指定にhealth.htmlを利用することを推奨します。

もしindex.htmlを指定していて何かのタイミングで、index.htmlを削除するとヘルスチェックに失敗してしまいます。

画像に alt 属性が指定されていません。ファイル名: スクリーンショット-2020-10-30-16.33.09-1024x562.png
🔗動作確認
この段階でALBのDNS名をブラウザに入力すると、2つのインスタンスのプライベートIPが交互に表示されるのが確認できます。

🔗スティッキーセッション
🔗スティッキーセッションの設定
1、2、3の順でクリックします。

画像に alt 属性が指定されていません。ファイル名: スクリーンショット-2020-10-30-16.39.58-1024x562.png
「Stickiness」にチェックを入れます。

画像に alt 属性が指定されていません。ファイル名: スクリーンショット-2020-10-30-16.42.31-1024x562.png
🔗動作確認
この段階でALBのDNS名をブラウザに入力してリロードすると、1つのインスタンスにしか負荷分散されていないのが分かります。


料金表
画像に alt 属性が指定されていません。ファイル名: Untitled-Diagram-1-3-1.png
まとめ
ユーザーが入力した情報を一時的に保持する様な場合には、このスティッキーセッションが向いているかと思います。

また、今回ブラウザにIPアドレスを表示させる様な設定をしましたが、これからもより簡単にこれらの設定をできる様に工夫して行きたいと思います。

